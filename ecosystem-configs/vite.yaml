ecosystem:
  name: "Vite"
  id: "vite"
  version: "1.0"
  
  detection:
    manifest_files:
      - "package.json"
      - "vite.config.js"
      - "vite.config.ts"
      - "vite.config.mjs"
      - "vite.config.cjs"
    required_files:
      - "package.json"
    optional_files:
      - "vite.config.js"
      - "vite.config.ts"
      - "vite.config.mjs"
      - "vite.config.cjs"
      - "package-lock.json"
      - "yarn.lock"
      - "pnpm-lock.yaml"
    directory_patterns:
      - "node_modules"
      - "src"
      - "public"
      
  manifest:
    primary_file: "vite.config.js"
    location: "."
    format: "javascript"
    
  cache:
    locations:
      - "${HOME}/.npm"
      - "${APPDATA}/npm-cache"
      - "${HOME}/.yarn/cache"
      - "${HOME}/.pnpm-store"
      - "node_modules/.vite"
    structure: "flat"
    artifact_pattern: ".*"
    
  build:
    output_directories:
      - "dist"
      - "build"
    artifact_patterns:
      - "dist/**/*"
      - "build/**/*"
    clean_command: "rm -rf dist build node_modules/.vite"
    
  dependencies:
    lock_file: "package-lock.json"
    lock_file_format: "json"
    resolve_command: "npm install"
    check_command: "npm ls"
    
  verification:
    build_freshness:
      manifest_timestamp_check: true
      cache_timestamp_check: false
      build_output_check: true
      commands:
        - name: "check_vite_config_vs_build"
          type: "timestamp_compare"
          source_pattern: "vite.config.*"
          target_pattern: "dist/**/*"
          description: "Check if Vite config is newer than build output"
          
        - name: "check_package_vs_build"
          type: "timestamp_compare"
          source: "package.json"
          target_pattern: "dist/**/*"
          description: "Check if package.json is newer than build output"
          
        - name: "check_src_vs_build"
          type: "timestamp_compare"
          source_pattern: "src/**/*"
          target_pattern: "dist/**/*"
          description: "Check if source files are newer than Vite build output"
          
    dependency_audit:
      enabled: true
      commands: []
          
  environment:
    variable_patterns:
      - "import\\.meta\\.env\\.([A-Z_][A-Z0-9_]*)"
      - "process\\.env\\.([A-Z_][A-Z0-9_]*)"
      - "VITE_([A-Z_][A-Z0-9_]*)"
    config_files:
      - ".env"
      - ".env.local"
      - ".env.development"
      - ".env.production"
      - ".env.*"
    required_vars: []
    
  infrastructure:
    services:
      - name: "node"
        type: "command"
        check_command: "node --version"
        version_extract: "v(\\d+\\.\\d+\\.\\d+)"
        
      - name: "npm"
        type: "command"
        check_command: "npm --version"
        version_extract: "(\\d+\\.\\d+\\.\\d+)"
        
  reconciliation:
    fixes:
      - issue_type: "stale_lock"
        command: "npm install"
        verify_command: "npm ls --depth=0"
        description: "Update package-lock.json to match package.json"
        
      - issue_type: "stale_build"
        command: "npm run build"
        verify_command: "test -d dist || test -d build"
        description: "Rebuild stale Vite artifacts"

